# AstraFlow 使用说明

## 📚 文档说明

项目的所有文档已整合到一个文件中，方便阅读：

### 主要文档

1. **[DOCUMENTATION.md](DOCUMENTATION.md)** - 📖 完整文档（推荐从这里开始）
   - 系统概述
   - 快速开始（5分钟上手）
   - 核心架构详解
   - 基础使用教程
   - 高级特性（LLM 工具 + 依赖验证）
   - 项目结构说明
   - 应用场景示例
   - 开发指南
   - 完整 API 参考

2. **[README.md](README.md)** - 📄 项目简介
   - 项目概览
   - 快速开始
   - 核心特性
   - 简单示例

## 🚀 快速开始

### 1. 安装依赖

```bash
cd /Users/guangyongchen/Research/mcp-aidd
pip install -r requirements.txt
```

### 2. 配置 API Key

编辑 `config.py` 文件，填入你的 OpenRouter API Key：

```python
OPENROUTER_API_KEY = "sk-or-v1-你的密钥"
OPENROUTER_BASE_URL = "https://openrouter.ai/api/v1"
DEFAULT_MODEL = "anthropic/claude-3.5-sonnet"
```

### 3. 运行演示

#### 方式 1：使用快捷脚本

```bash
./run_demo.sh
```

然后选择：
- `1` - 基础演示（使用模拟 LLM）
- `2` - OpenRouter API 演示（真实 LLM）✨
- `3` - 高级功能演示（LLM 工具 + 依赖验证）✨
- `4` - 运行测试
- `5` - 查看生成的反馈数据

#### 方式 2：直接运行 Python 脚本

```bash
# 真实 LLM 演示
python examples/demo_with_openrouter.py

# 高级功能演示
python examples/demo_advanced.py

# 基础演示（模拟 LLM）
python examples/demo.py
```

## 📖 推荐阅读顺序

### 新手入门

1. 先看 **README.md** 了解项目概况
2. 运行演示体验系统
3. 阅读 **DOCUMENTATION.md** 第 1-4 章（系统概述、快速开始、核心架构、基础使用）

### 进阶使用

4. 阅读 **DOCUMENTATION.md** 第 5 章（高级特性）
   - LLM 驱动的工具
   - 工具依赖验证
   - 专用软件集成
5. 查看 `examples/` 目录下的示例代码
6. 参考第 8 章（开发指南）创建自己的工具

### 完整开发

7. 阅读第 6 章（项目结构）了解代码组织
8. 阅读第 7 章（应用场景）了解实际用例
9. 查看第 9 章（API 参考）进行深度开发

## 📂 关键文件位置

```
mcp-aidd/
├── DOCUMENTATION.md        ⭐ 完整文档（主要阅读）
├── README.md               📄 项目简介
├── 使用说明.md             📖 本文件
├── config.py               🔧 配置文件（API Key）
├── run_demo.sh            🚀 快捷启动脚本
│
├── astraflow/              💎 核心库
│   ├── models.py           - 数据模型
│   ├── tool_registry.py    - 工具注册
│   ├── workflow_generator.py - 工作流生成
│   ├── mcp.py              - 执行引擎
│   ├── feedback_collector.py - 反馈收集
│   ├── llm_tools.py        - LLM 工具 ✨
│   └── tool_validator.py   - 依赖验证 ✨
│
├── examples/               📚 演示和示例
│   ├── demo_with_openrouter.py  - OpenRouter 演示 ✨
│   ├── demo_advanced.py         - 高级功能演示 ✨
│   ├── demo.py                  - 基础演示
│   └── example_tools.py         - 示例工具
│
├── tests/                  🧪 测试
│   └── test_basic.py
│
└── data/                   💾 数据存储
    └── feedback_labels/    - 反馈标签 JSON
```

## 💡 使用技巧

### 查看生成的数据

```bash
# 查看反馈标签文件
ls -lh data/feedback_labels/

# 查看 JSON 内容（需要安装 jq）
cat data/feedback_labels/label-*.json | jq .
```

### 修改模型

编辑 `config.py`：

```python
# 使用不同的模型
DEFAULT_MODEL = "openai/gpt-4"                    # OpenAI GPT-4
DEFAULT_MODEL = "anthropic/claude-3.5-sonnet"     # Anthropic Claude
DEFAULT_MODEL = "google/gemini-pro"               # Google Gemini
DEFAULT_MODEL = "meta-llama/llama-3.1-70b"        # Meta Llama
```

**查看 OpenRouter 完整模型列表**：
- 🌐 访问：https://openrouter.ai/models
- 📖 API 文档：https://openrouter.ai/docs
- 💡 选择你需要的模型，复制模型 ID（如 `anthropic/claude-3.5-sonnet`）到 `config.py`

### 添加自定义工具

参考 `examples/example_tools.py`，然后在你的代码中注册：

```python
from astraflow import ToolRegistry, ToolSchema, ...

registry = ToolRegistry()
registry.register(your_tool_schema, your_tool_function)
```

## 🎯 适用场景

### AI 药物设计 (AIDD)
- 文献分析 + 分子对接 + 分子动力学
- 详见 DOCUMENTATION.md 第 7.1 节

### 蛋白质结构预测
- AlphaFold2/ESMFold 集成
- 详见 DOCUMENTATION.md 第 7.2 节

### 量子化学计算
- Quantum ESPRESSO/ORCA 集成
- 详见 DOCUMENTATION.md 第 7.3 节

## 💡 高级概念说明

### 工具的三种类型

| 类型 | 说明 | 适用场景 | 可靠性 |
|------|------|---------|--------|
| **本地函数** | 你写的 Python 函数 | 任何计算、数据处理 | ⭐⭐⭐⭐⭐ |
| **API 工具** | 在线服务（HTTP API） | AlphaFold3、OpenMM 云端 | ⭐⭐⭐⭐ |
| **LLM 工具** ⚠️ | 让 LLM 执行任务 | 文本总结（不精确） | ⭐⭐ |

### 混合工作流

**混合工作流 = 一个工作流里包含多种类型的工具**

示例：同一个工作流中使用本地函数 + API 工具 + LLM 工具

### 依赖检查

在注册使用本地软件的工具前，检查软件是否已安装，并提示安装方法。

### LLM 工具的注意事项 ⚠️

**警告**：LLM 工具让 LLM 直接执行任务，容易出错！

✅ **适合**：文本总结、改写、生成描述
❌ **不适合**：精确计算、结构化数据处理、关键决策

**建议**：优先使用本地函数或 API 工具，LLM 工具仅用于辅助性文本处理。

---

## ❓ 常见问题

### 问：如何切换不同的 LLM？

修改 `config.py` 中的 `DEFAULT_MODEL`，或在代码中指定：

```python
generator = WorkflowGenerator(client, model_name="openai/gpt-4")
```

### 问：如何处理依赖缺失的工具？

系统会自动检测并提示安装说明。参考 DOCUMENTATION.md 第 5.2 节。

### 问：如何查看工作流执行日志？

日志会自动保存到 `data/feedback_labels/` 目录，包含每一步的详细信息。

## 📞 获取更多帮助

- 📖 阅读 **DOCUMENTATION.md** 获取完整信息
- 💻 查看 `examples/` 目录的示例代码
- 🧪 运行 `tests/` 目录的测试了解用法

## 🔄 更新日志

- **v0.1.0** (2025-11-10)
  - ✅ 核心系统实现
  - ✅ LLM 工具集成
  - ✅ 依赖验证功能
  - ✅ OpenRouter API 测试通过
  - ✅ 文档整合完成

---

**开始阅读：[DOCUMENTATION.md](DOCUMENTATION.md)** 📖

**快速体验：`./run_demo.sh`** 🚀

